<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Zaman Serisi Analiz ve Tahmin Dashboard</title>
  <style>
    :root{
      --bg:#f8fafc; --card:#ffffff; --text:#1e293b; --muted:#64748b;
      --border:#e2e8f0; --shadow:0 10px 15px -3px rgba(0,0,0,0.1);
      --accent:#3b82f6; --warn-bg:#fff7ed; --warn-text:#9a3412; --ok-text:#065f46;
    }
    body{ margin:0; font-family: 'Inter', system-ui, -apple-system, sans-serif; background:var(--bg); color:var(--text); line-height: 1.5; }
    .wrap{ max-width:1200px; margin:32px auto; padding:0 20px; }
    
    .header-area{ text-align:center; margin-bottom:30px; }
    h1{ font-size:30px; margin:0 0 8px; font-weight: 800; color: #0f172a; }
    .sub{ color:var(--muted); font-size:14px; margin-bottom:12px; }
    
    .disclaimer {
      background: #f1f5f9; border: 1px solid #cbd5e1; color: #334155; padding: 14px;
      border-radius: 10px; font-size: 13px; margin-bottom: 24px; text-align: left;
    }

    .grid{ display:grid; grid-template-columns: repeat(5, 1fr); gap:16px; }
    .card{
      background:var(--card); border:1px solid var(--border); border-radius:16px;
      box-shadow:var(--shadow); padding:20px;
      display: flex; flex-direction: column; justify-content: space-between;
    }
    .k{ color:var(--muted); font-size:11px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom:8px; line-height: 1.2; }
    .v{ font-size:24px; font-weight:800; color:#0f172a; }
    .note{ color:var(--muted); font-size:11.5px; margin-top:10px; line-height:1.4; }
    
    .status-badge { padding: 4px 10px; border-radius: 6px; font-size: 17px; font-weight: 700; display: inline-block; }
    .ok{ color:var(--ok-text); background:#ecfdf5; }
    .warn{ color:var(--warn-text); background:var(--warn-bg); }

    .grid2{ display:grid; grid-template-columns: 1fr 1fr; gap:20px; margin-top:20px; }
    /* Sonuç Bölümü için Tam Genişlik Sınıfı */
    .full-width { grid-column: 1 / -1; }

    .card h2{ font-size:17px; margin:0 0 16px; font-weight: 700; color: #334155; }
    .imgbox{ border:1px solid var(--border); border-radius:12px; background:#fff; padding:8px; }
    img{ width:100%; height:auto; display:block; }

    .grid3{ display:grid; grid-template-columns: 1fr 1fr 1fr; gap:20px; margin-top:20px; }
    ul{ margin:10px 0 0 18px; padding:0; }
    li{ margin:8px 0; font-size: 13.5px; color: #334155; }
    
    .evaluation-text {
      background: #f8fafc; padding: 16px; border-radius: 12px;
      border-left: 4px solid #64748b; font-size: 14.5px; margin-top: 10px; color: #1e293b;
    }
    .evaluation-text p { margin: 0 0 12px 0; }
    .evaluation-text p:last-child { margin-bottom: 0; }

    .foot{ margin-top:40px; color:var(--muted); font-size:12px; text-align:center; padding-bottom: 40px; }

    @media (max-width: 1100px){
      .grid{ grid-template-columns: repeat(2, 1fr); }
      .grid2, .grid3{ grid-template-columns: 1fr; }
      .full-width { grid-column: auto; }
    }
    code{ background:#f1f5f9; padding:2px 4px; border-radius:4px; font-weight: 600; color: #475569; }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="header-area">
      <h1>AI Destekli Enerji Veri Analitiği</h1>
      <div class="sub" id="subtitle">Model Performans Değerlendirme Dashboard'u</div>
      
      <div class="disclaimer">
        <strong>Akademik Not:</strong> Tüm enerji metrikleri saatlik agregasyon (kWh) üzerinden hesaplanmıştır. Sistem durumu çıkarımları, anlık güç tüketimi yerine saatlik yük yoğunluğunu ifade eden birer "Yük Göstergesi"dir.
      </div>
    </div>

    <!-- TOP KPIs -->
    <div class="grid">
      <div class="card">
        <div class="k">Veri Kümesi Boyutu</div>
        <div class="v" id="rawCount">-</div>
        <div class="note" id="datasetName">Ham veri kayıt sayısı</div>
      </div>

      <div class="card">
        <div class="k">Gözlem Noktası (Saatlik)</div>
        <div class="v" id="hourlyCount">-</div>
        <div class="note">Örneklem Aralığı: <code id="agg">-</code></div>
      </div>

      <div class="card">
        <div class="k">Ortalama Hata Payı</div>
        <div class="v" id="mape">-</div>
        <div class="note">Metrik: <code>MAPE</code> (Test Seti)</div>
      </div>

      <div class="card">
        <div class="k">Normalize Performans Göstergesi</div>
        <div class="v" id="score">-</div>
        <div class="note">MAPE tabanlı ölçeklendirilmiş değer</div>
      </div>

      <div class="card">
        <div class="k">Yük Yoğunluk Sınıfı</div>
        <div class="v" id="status">-</div>
        <div class="note">
          Ref: <span id="cap">-</span> kW | Ortalama: <span id="avg">-</span> kWh
        </div>
      </div>
    </div>

    <!-- CHARTS -->
    <div class="grid2">
      <div class="card">
        <h2>Eğitim ve Doğrulama Kayıpları</h2>
        <div class="imgbox"><img id="lossImg" alt="Training Loss Grafiği" /></div>
        <div class="note">Modelin eğitim sürecindeki öğrenme eğrisi (Learning Curve).</div>
      </div>

      <div class="card">
        <h2>Tahmin Performansı (Zaman Serisi)</h2>
        <div class="imgbox"><img id="testImg" alt="Test Tahmin Grafiği" /></div>
        <div class="note">Bağımsız test seti üzerindeki tahmin başarısı.</div>
      </div>
    </div>

    <!-- DETAILS -->
    <div class="grid2">
      <div class="card">
        <h2>Model Mimarisi & Analiz</h2>
        <div class="note" style="font-size:13px; color:var(--text); margin-bottom:12px;">
          <div><b>Algoritma:</b> <span id="modelName">-</span></div>
          <div><b>Hiperparametreler:</b> Batch: <span id="batch">-</span> | Epoch: <span id="epochs">-</span></div>
        </div>
        <div class="evaluation-text">
          <strong>Analiz Özeti:</strong> <span id="aiEval">Model çıktıları, saatlik enerji tüketiminin güçlü zamansal bağımlılık (temporal dependency) içerdiğini ve geçmiş örüntülerden öğrenilebilir bir yapı sergilediğini kanıtlamaktadır.</span>
        </div>
      </div>

      <div class="card">
        <h2>Anomali Tespit Metodolojisi</h2>
        <div class="note" style="font-size:14px; color:var(--text);">
          <div style="margin-bottom:12px;">
            <b>İstatistiksel Yaklaşım (Z-Score):</b>
            <div class="muted" style="font-size:12px; color:var(--muted)">Sayısal eşik aşımı tespiti. Oran: %<span id="zratio">-</span></div>
          </div>
          <div>
            <b>Makine Öğrenmesi (Isolation Forest):</b>
            <div class="muted" style="font-size:12px; color:var(--muted)">Davranışsal sapma tespiti. Oran: %<span id="mlratio">-</span></div>
          </div>
        </div>
      </div>
    </div>

    <!-- HEDEF: PROJE SONUCU & KAZANIMLAR (TAM GENİŞLİK) -->
    <div class="grid2">
      <div class="card full-width">
        <h2>Proje Sonucu & Kazanımlar</h2>
        <div class="evaluation-text">
          <p>
            Bu çalışma kapsamında, akıllı ev ortamlarında oluşan enerji tüketim verileri kullanılarak zaman serisi tabanlı bir analiz ve tahmin sistemi geliştirilmiştir.
          </p>
          <p>
            GRU tabanlı derin öğrenme modeli, saatlik enerji tüketiminde mevcut olan zamansal bağımlılıkları başarıyla öğrenmiş ve test verisi üzerinde <b>%8.2 MAPE</b> hata oranı ile yüksek doğruluklu tahminler üretebilmiştir.
          </p>
          <p>
            Tahmin modülüne ek olarak, hem istatistiksel (Z-Score) hem de makine öğrenmesi tabanlı (Isolation Forest) anomali tespit yöntemleri uygulanarak, olağandışı tüketim davranışları belirlenmiştir.
          </p>
          <p>
            Elde edilen sonuçlar, sistemin yalnızca geçmiş veriyi analiz etmekle kalmayıp, geleceğe yönelik öngörü ve karar destek sağlayabildiğini göstermektedir. Bu yönüyle proje, gerçek zamanlı sensör verileriyle entegre edilebilecek AI destekli bir enerji izleme ve yönetim altyapısı için uygulanabilir bir temel sunmaktadır.
          </p>
        </div>
      </div>
    </div>

    <!-- EXPLANATIONS -->
    <div class="grid3">
      <div class="card">
        <h2>Metodoloji Tercihi</h2>
        <ul id="whyList"></ul>
      </div>
      <div class="card">
        <h2>Sistem Sınırlılıkları</h2>
        <ul id="limList"></ul>
      </div>
      <div class="card">
        <h2>Gelecek Perspektifi</h2>
        <ul id="futList"></ul>
      </div>
    </div>

    <div class="foot" id="foot">—</div>
  </div>

<script>
  function setText(id, val){ document.getElementById(id).textContent = val; }
  function addList(id, items){
    const ul = document.getElementById(id);
    ul.innerHTML = "";
    (items || []).forEach(t => {
      const li = document.createElement("li");
      li.textContent = t;
      ul.appendChild(li);
    });
  }

  async function load(){
    const r = await fetch("results.json", { cache: "no-store" });
    const data = await r.json();

    setText("subtitle", `Veri Kaynağı: ${data.dataset?.source_file || "-"} | Akademik Değerlendirme Modülü`);
    setText("rawCount", data.dataset?.total_records_raw ?? "-");
    setText("hourlyCount", data.dataset?.total_points_hourly ?? "-");
    setText("agg", data.dataset?.aggregation ?? "-");
    setText("datasetName", `Kaynak: ${data.dataset?.name || "-"}`);

    const mape = data.forecasting?.test_mape_percent;
    setText("mape", (mape !== undefined) ? `%${mape}` : "-");
    setText("score", data.forecasting?.score_0_100 ?? "-");
    setText("modelName", data.forecasting?.model ?? "-");
    setText("batch", data.forecasting?.batch_size ?? "-");
    setText("epochs", data.forecasting?.max_epochs ?? "-");

    document.getElementById("lossImg").src = data.forecasting?.artifacts?.loss_plot + `?v=${Date.now()}`;
    document.getElementById("testImg").src = data.forecasting?.artifacts?.test_plot + `?v=${Date.now()}`;

    setText("cap", data.energy_efficiency?.reference_capacity_kw ?? "-");
    setText("avg", data.energy_efficiency?.avg_kw_proxy ?? "-");

    const st = data.energy_efficiency?.system_status ?? "-";
    const statusEl = document.getElementById("status");
    if(st === "Riskli"){
        statusEl.textContent = "Yüksek Yük"; statusEl.className = "status-badge warn";
    } else {
        statusEl.textContent = "Nominal Yük"; statusEl.className = "status-badge ok";
    }

    setText("zratio", data.anomaly_analysis?.baseline?.anomaly_ratio_percent ?? "-");
    setText("mlratio", data.anomaly_analysis?.ml_based?.anomaly_ratio_percent ?? "-");

    addList("whyList", data.explanations?.why_this_method);
    addList("limList", data.explanations?.limitations);
    addList("futList", data.explanations?.future_work);

    setText("foot", `Raporlama Tarihi: ${new Date().toLocaleString("tr-TR")}`);
  }
  load().catch(err => console.error(err));
</script>
</body>
</html>